<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gleam Service Estimator V3.38</title>
</head>
<body style="background-color: #f4f4f4; padding: 20px; font-family: sans-serif;">

<!-- GLEAM SERVICE ESTIMATOR V3.38 (Larger Labels & Icons) -->
<div id="gleam-calc-v3">

<!-- FONTS (Scoped to this widget via ID) -->
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;600;700;800&display=swap" rel="stylesheet">

<style>
    /* --- SCOPED VARIABLES & RESET --- */
    #gleam-calc-v3 {
        --gc-primary: #3D9898;        /* Gleam Cyan */
        --gc-primary-dark: #279493;
        --gc-accent: #FFC107;         /* Sparkle Gold */
        --gc-accent-dark: #D69E2E;
        --gc-text: #2D3748;
        --gc-subtext: #718096;
        --gc-bg: #FFFFFF;
        --gc-border: #EDF2F7;
        --gc-success: #48BB78;
        --gc-danger: #E53E3E;
        --gc-disabled: #CBD5E0;       /* Disabled Button Color */

        /* Container Styles */
        font-family: 'Open Sans', sans-serif;
        color: var(--gc-text);
        background: var(--gc-bg);
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        border: 1px solid var(--gc-border);
        max-width: 600px;
        margin: 0 auto;
        overflow: hidden;
        position: relative;
        text-align: left;
        line-height: 1.5;
        min-height: 600px;
    }

    #gleam-calc-v3 * { box-sizing: border-box; }

    /* --- MODAL / SEGMENTATION STYLES --- */
    .gc-modal-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(128, 128, 128, 0.15); 
        backdrop-filter: none; 
        -webkit-backdrop-filter: none;
        z-index: 100;
        display: flex; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
    }
    .gc-modal-overlay.active { opacity: 1; pointer-events: all; }

    .gc-modal-card {
        background: #FFFFFF;
        width: 90%; max-width: 440px;
        border-radius: 24px;
        box-shadow: 0 20px 60px -10px rgba(0, 0, 0, 0.25); 
        border: 1px solid #EDF2F7;
        padding: 45px 35px;
        text-align: center;
        animation: gcPopUp 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        position: relative;
    }
    @keyframes gcPopUp { 
        from { transform: scale(0.95) translateY(10px); opacity: 0; } 
        to { transform: scale(1) translateY(0); opacity: 1; } 
    }

    .gc-seg-title { 
        font-family: 'Poppins', sans-serif; font-size: 26px; font-weight: 700; 
        color: #2D3748; margin-bottom: 15px; letter-spacing: -0.5px; line-height: 1.3;
    }
    .gc-seg-sub { font-size: 15px; color: #718096; margin-bottom: 35px; line-height: 1.6; }
    
    .gc-seg-type-grid { 
        display: flex; justify-content: center; gap: 10px; margin-bottom: 35px; 
        border-bottom: 1px solid #EDF2F7; padding-bottom: 25px;
    }
    .gc-seg-type-btn {
        padding: 10px 20px;
        cursor: pointer; transition: all 0.2s ease; 
        border: 1px solid transparent;
        border-radius: 30px;
        font-weight: 600;
        font-size: 14px;
        color: #718096;
        background: #F7FAFC;
    }
    .gc-seg-type-btn:hover { 
        color: var(--gc-primary);
        background: #F0FDFA;
    }
    .gc-seg-type-btn.active { 
        background: var(--gc-primary); 
        color: #FFFFFF;
        box-shadow: 0 4px 10px rgba(61,152,152,0.2);
    }
    
    .gc-input-field {
        width: 100%; padding: 16px 20px; 
        border: 1px solid #E2E8F0; border-radius: 12px;
        font-size: 15px; margin-bottom: 12px; outline: none; transition: 0.2s;
        font-family: 'Open Sans', sans-serif; color: #2D3748;
        background: #FAFAFA;
    }
    .gc-input-field:focus { 
        border-color: var(--gc-primary); background: #FFFFFF; 
        box-shadow: 0 0 0 3px rgba(61, 152, 152, 0.1);
    }
    .gc-input-field::placeholder { color: #A0AEC0; }
    
    .gc-input-field.valid { border-color: var(--gc-success); background: #F0FFF4; }
    .gc-input-field.invalid { border-color: var(--gc-danger); background: #FFF5F5; }

    #gcResForm, #gcBizForm { display: none; animation: fadeIn 0.3s ease; }
    #gcResForm.active, #gcBizForm.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .gc-error-msg { 
        color: #C53030; font-size: 13px; font-weight: 600; 
        background: #FFF5F5; padding: 12px; border-radius: 8px;
        margin-bottom: 15px; display: none; text-align: center; border: 1px solid #FED7D7;
    }
    .gc-success-msg { 
        color: #276749; font-size: 13px; font-weight: 600; 
        background: #F0FFF4; padding: 12px; border-radius: 8px;
        margin-bottom: 15px; display: none; text-align: center; border: 1px solid #C6F6D5;
    }
    
    .gc-btn-lg {
        background: linear-gradient(135deg, var(--gc-primary) 0%, var(--gc-primary-dark) 100%);
        color: white; border: none; padding: 16px; border-radius: 12px;
        font-weight: 700; font-size: 16px; cursor: pointer; width: 100%;
        box-shadow: 0 8px 20px rgba(61,152,152,0.25); transition: 0.2s;
        margin-top: 10px;
    }
    .gc-btn-lg:hover { transform: translateY(-2px); box-shadow: 0 12px 25px rgba(61,152,152,0.35); }
    
    .gc-btn-lg:disabled {
        background: var(--gc-disabled);
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
        color: #FFFFFF;
    }
    
    .gc-contact-box {
        margin-top: 25px; padding: 15px; background: #4A5568; border-radius: 12px;
        color: white; font-size: 14px; opacity: 1;
        display: flex; flex-direction: column; gap: 4px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .gc-contact-link { color: white; font-weight: 700; text-decoration: none; font-size: 18px; display: block; margin-top: 2px;}

    /* --- TOP PROGRESS --- */
    .gc-progress-track { height: 6px; background: var(--gc-border); width: 100%; }
    .gc-progress-fill { height: 100%; background: var(--gc-primary); width: 33%; transition: width 0.4s ease; }

    /* --- CONTENT AREA --- */
    .gc-content { padding: 30px 20px 140px 20px; min-height: 500px; }
    
    .gc-view { display: none; animation: gcFadeIn 0.4s ease-out; }
    .gc-view.active { display: block; }
    @keyframes gcFadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }

    /* --- TYPOGRAPHY --- */
    .gc-title { font-family: 'Poppins', sans-serif; font-size: 24px; font-weight: 700; margin: 0 0 8px 0; text-align: center; color: #1A202C; }
    .gc-subtitle { font-size: 14px; color: var(--gc-subtext); text-align: center; margin-bottom: 25px; line-height: 1.5; }

    /* --- STEP 1: BUNDLE SAVINGS BAR --- */
    .gc-savings-container {
        background: #FFFFFF;
        border: 2px solid var(--gc-border);
        border-radius: 14px;
        padding: 20px 15px;
        margin-bottom: 25px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .gc-savings-container.unlocked-basic { border-color: var(--gc-primary); background: #F0FDFA; transform: scale(1.02); }
    .gc-savings-container.unlocked-premium { border-color: var(--gc-accent); background: #FFFCF0; transform: scale(1.02); }
    .gc-savings-container.unlocked-plus { border-color: var(--gc-primary-dark); background: #E6FFFA; transform: scale(1.02); box-shadow: 0 8px 20px rgba(61,152,152,0.15); }

    .gc-savings-track {
        height: 14px;
        background: #E2E8F0;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 12px;
        position: relative;
        border: 1px solid rgba(0,0,0,0.05);
    }
    .gc-savings-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--gc-primary) 0%, var(--gc-primary-dark) 100%);
        width: 0%;
        transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
    }
    .gc-savings-bar::after {
        content: ""; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.2) 75%, transparent 75%, transparent);
        background-size: 20px 20px;
        animation: gcMoveStripe 1s linear infinite;
    }
    @keyframes gcMoveStripe { 0% { background-position: 0 0; } 100% { background-position: 20px 20px; } }

    .gc-savings-status { font-family: 'Poppins', sans-serif; font-size: 15px; font-weight: 700; color: var(--gc-text); display: flex; align-items: center; justify-content: center; gap: 8px; line-height: 1.3; }
    .gc-sparkle-img { width: 24px; height: 24px; object-fit: contain; }

    /* --- SERVICE GRID --- */
    .gc-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
        gap: 15px; 
        justify-content: center;
    }
    .gc-card {
        background: #FFFFFF;
        border: 2px solid var(--gc-border);
        border-radius: 12px;
        padding: 5px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        overflow: hidden;
        max-width: 200px;
        margin: 0 auto;
        height: 100%;
        min-height: 180px;
    }
    .gc-card:hover { transform: translateY(-3px); border-color: #CBD5E0; box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
    .gc-card.selected { 
        border-color: var(--gc-primary); 
        background: #F0FDFA; 
        box-shadow: 0 0 0 2px var(--gc-primary) inset;
    }
    
    .gc-icon { 
        width: 100%; 
        height: 130px;
        object-fit: contain; 
        transition: transform 0.3s ease;
        margin-top: 10px;
    }
    .gc-card:hover .gc-icon { transform: scale(1.05); }

    .gc-card-label { 
        font-size: 15px; 
        font-weight: 700; 
        color: var(--gc-text); 
        line-height: 1.2; 
        margin: 10px 0 4px 0;
        padding: 0 5px;
    }
    .gc-card-sub { 
        font-size: 11px;
        color: var(--gc-subtext); 
        padding: 0 5px 10px 5px;
        line-height: 1.3;
    }

    .gc-check-circle {
        position: absolute; top: 8px; right: 8px; width: 22px; height: 22px;
        background: var(--gc-primary); border-radius: 50%; color: white;
        display: flex; align-items: center; justify-content: center;
        font-size: 14px; opacity: 0; transform: scale(0.5); transition: 0.2s; z-index: 2;
    }
    .gc-card.selected .gc-check-circle { opacity: 1; transform: scale(1); }

    /* --- INPUT GROUPS --- */
    .gc-input-group { margin-bottom: 35px; border-bottom: 1px dashed var(--gc-border); padding-bottom: 25px; }
    .gc-input-group:last-child { border-bottom: none; border: none; padding-bottom: 0; }
    
    .gc-label { 
        font-size: 22px; font-weight: 700; color: var(--gc-text); 
        margin-bottom: 18px; display: flex; align-items: center; gap: 18px;
    }
    .gc-label-icon { width: 54px; height: 54px; object-fit: contain; }
    .gc-label-text { display: flex; flex-direction: column; }
    .gc-label-sub { font-size: 14px; color: var(--gc-subtext); font-weight: 400; margin-top: 4px;}

    .gc-pill-row { display: flex; gap: 8px; justify-content: space-between; }
    .gc-pill-opt {
        flex: 1; border: 1px solid #CBD5E0; border-radius: 8px; padding: 12px 5px;
        text-align: center; font-size: 13px; font-weight: 600; color: var(--gc-subtext);
        cursor: pointer; transition: 0.2s; background: white;
        display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px;
    }
    .gc-pill-opt:hover { border-color: var(--gc-primary); color: var(--gc-primary); }
    .gc-pill-opt.active { background: var(--gc-primary); color: white; border-color: var(--gc-primary); box-shadow: 0 4px 10px rgba(61,152,152,0.3); }
    .gc-pill-sub { display: block; font-size: 10px; font-weight: 400; margin-top: 4px; opacity: 0.9; }
    .gc-pill-icon { height: 40px; width: auto; object-fit: contain; margin-bottom: 2px; }
    
    /* NEW HOUSE CARDS STYLE */
    .gc-house-grid { 
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px; 
    }
    .gc-house-card {
        border: 2px solid #EDF2F7; border-radius: 12px; padding: 15px 5px;
        text-align: center; cursor: pointer; transition: all 0.2s; background: #fff;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .gc-house-card:hover { border-color: #CBD5E0; transform: translateY(-2px); }
    .gc-house-card.active { border-color: var(--gc-primary); background: #F0FDFA; box-shadow: 0 4px 12px rgba(61,152,152,0.2); }
    .gc-house-img { width: 100%; height: 60px; object-fit: contain; margin-bottom: 8px; opacity: 0.8; }
    .gc-house-card.active .gc-house-img { opacity: 1; transform: scale(1.1); }
    .gc-house-title { font-weight: 700; font-size: 14px; color: #2D3748; display: block; line-height: 1.2; }
    .gc-house-sub { font-size: 11px; color: #718096; display: block; margin-top: 2px; }

    .gc-text-btn {
        background: none; border: none; padding: 0;
        color: var(--gc-primary); font-size: 12px; font-weight: 600; 
        text-decoration: underline; cursor: pointer; margin-top: 5px;
    }
    .gc-text-btn:hover { color: var(--gc-primary-dark); }

    .gc-slider-container { text-align: center; margin-top: 30px; }
    
    #gcMainSqftInput {
        font-family: 'Poppins', sans-serif;
        font-size: 28px;
        font-weight: 700;
        color: var(--gc-primary);
        border: 1px solid #CBD5E0;
        border-radius: 12px;
        background: #F7FAFC;
        box-shadow: inset 0 2px 6px rgba(0,0,0,0.06);
        width: 140px;
        text-align: center;
        outline: none;
        transition: all 0.2s;
        padding: 8px;
        margin: 0;
        cursor: text;
    }
    #gcMainSqftInput:focus { 
        border-color: var(--gc-primary); 
        background: #FFFFFF; 
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.04), 0 0 0 3px rgba(61, 152, 152, 0.1); 
    }
    
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
        -webkit-appearance: none; 
        margin: 0; 
    }
    
    #gleam-calc-v3 input[type=range] {
        width: 100%; height: 6px; background: #E2E8F0; border-radius: 3px;
        outline: none; -webkit-appearance: none; margin: 15px 0; display: block; 
    }
    #gleam-calc-v3 input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none; width: 24px; height: 24px; background: var(--gc-primary);
        border: 3px solid #fff; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.2); cursor: pointer;
    }

    .gc-toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; }
    .gc-toggle-label { font-size: 14px; font-weight: 600; color: var(--gc-text); display: flex; align-items: center; gap: 8px; }
    .gc-switch { position: relative; display: inline-block; width: 46px; height: 24px; }
    .gc-switch input { opacity: 0; width: 0; height: 0; }
    .gc-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #CBD5E0; transition: .4s; border-radius: 34px; }
    .gc-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .gc-slider { background-color: var(--gc-primary); }
    input:checked + .gc-slider:before { transform: translateX(22px); }

    .gc-counter-wrapper { display: flex; align-items: center; gap: 12px; }
    .gc-counter-btn { 
        width: 32px; height: 32px; border-radius: 50%; background: #fff; border: 1px solid #CBD5E0; 
        font-size: 18px; font-weight: 600; color: var(--gc-text); cursor: pointer; 
        display: flex; align-items: center; justify-content: center; transition: 0.2s;
    }
    .gc-counter-btn:hover { border-color: var(--gc-primary); color: var(--gc-primary); background: #F0FDFA; }
    .gc-counter-val { font-size: 16px; font-weight: 700; color: var(--gc-text); width: 24px; text-align: center; }

    .gc-result-card {
        background: linear-gradient(180deg, #FFFFFF 0%, #F7FAFC 100%);
        border: 1px solid var(--gc-border); border-radius: 16px;
        padding: 25px 20px; text-align: center; position: relative;
        box-shadow: 0 10px 20px -5px rgba(0,0,0,0.05);
    }
    .gc-price-big { font-family: 'Poppins', sans-serif; font-size: 42px; font-weight: 700; color: var(--gc-text); margin: 5px 0; letter-spacing: -1px; }
    
    .gc-range-display {
        display: flex; 
        align-items: center; 
        justify-content: center; 
        gap: 15px; 
        margin-bottom: 25px; 
        padding: 12px 0; 
        border-top: 1px solid var(--gc-border); 
        border-bottom: 1px solid var(--gc-border);
    }
    .gc-range-item { flex: 1; }
    .gc-range-label { display: block; font-size: 10px; font-weight: 800; color: #A0AEC0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
    .gc-range-val { font-size: 20px; font-weight: 700; color: #4A5568; }
    .gc-range-divider { width: 1px; height: 32px; background: #E2E8F0; align-self: center; }

    .gc-breakdown-table { width: 100%; margin: 20px 0; border-collapse: collapse; font-size: 13px; }
    .gc-breakdown-table th { text-align: left; color: #718096; font-weight: 600; padding-bottom: 8px; border-bottom: 1px solid #E2E8F0; }
    .gc-breakdown-table td { text-align: left; padding: 8px 0; border-bottom: 1px dashed #E2E8F0; color: #2D3748; vertical-align: middle; }
    .gc-breakdown-table td:last-child { text-align: right; font-weight: 600; }
    .gc-breakdown-table td.gc-td-time { color: #718096; font-size: 12px; }
    
    .gc-price-stack { display: flex; flex-direction: column; align-items: flex-end; line-height: 1.2; }
    .gc-price-old { text-decoration: line-through; color: #A0AEC0; font-size: 11px; font-weight: 400; }
    .gc-price-new { color: var(--gc-success); font-weight: 700; font-size: 14px; }
    .gc-savings-pill { 
        font-size: 9px; background: #F0FFF4; color: var(--gc-success); 
        padding: 2px 6px; border-radius: 10px; margin-left: 5px; 
        border: 1px solid #C6F6D5; display: inline-block;
    }
    
    .gc-total-savings {
        display: flex; justify-content: space-between; 
        background: #F0FDFA; border: 1px solid #B2F5EA; border-radius: 8px;
        padding: 10px 15px; margin-bottom: 15px; color: var(--gc-primary-dark);
        font-weight: 700; font-size: 13px;
    }

    .gc-stats-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 13px; color: #4A5568; background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #EDF2F7;}
    .gc-stat-item { display: flex; flex-direction: column; align-items: center; width: 33%; }
    .gc-stat-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #A0AEC0; margin-bottom: 2px;}
    .gc-stat-val { font-weight: 700; color: #2D3748; }

    .gc-trust-section {
        margin-top: 20px; border-top: 1px dashed #E2E8F0; padding-top: 15px;
        display: flex; flex-direction: column; gap: 10px;
    }
    .gc-trust-item {
        display: flex; align-items: center; gap: 12px; text-align: left;
        background: #fff; border: 1px solid #EDF2F7; padding: 12px;
        border-radius: 10px; font-size: 12px; color: #4A5568; transition: transform 0.2s;
        cursor: pointer;
        text-decoration: none;
    }
    .gc-trust-item:hover { border-color: var(--gc-primary); transform: translateX(2px); }
    .gc-trust-icon { width: 32px; height: 32px; object-fit: contain; flex-shrink: 0; }
    .gc-trust-bold { font-weight: 700; color: var(--gc-text); font-size: 13px; display: block; margin-bottom: 2px; }

    .gc-footer {
        position: absolute; bottom: 0; left: 0; width: 100%;
        background: #fff; padding: 15px 20px; border-top: 1px solid var(--gc-border);
        display: flex; flex-direction: column; gap: 12px; z-index: 10;
    }
    .gc-btn {
        background: linear-gradient(135deg, var(--gc-primary) 0%, var(--gc-primary-dark) 100%);
        color: white; border: none; padding: 16px 20px; border-radius: 12px;
        font-weight: 700; font-size: 16px; cursor: pointer; width: 100%;
        box-shadow: 0 4px 12px rgba(61,152,152,0.3); transition: 0.2s;
        text-align: center;
    }
    .gc-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 15px rgba(61,152,152,0.4); }
    .gc-btn:disabled { background: #CBD5E0; cursor: not-allowed; box-shadow: none; transform: none; color: #FFFFFF; }
    
    .gc-nav-row { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 5px; }
    .gc-back { 
        background: none; border: none; color: #A0AEC0; font-weight: 600; 
        cursor: pointer; font-size: 13px; padding: 5px; display: flex; align-items: center; gap: 4px;
    }
    .gc-back:hover { color: var(--gc-text); }
    .gc-step-badge { font-size: 12px; font-weight: 600; color: #CBD5E0; }

</style>

<div id="gcSegModal" class="gc-modal-overlay">
    <div class="gc-modal-card">
        <div id="gcResHeader" class="active">
            <h2 class="gc-seg-title">First things first,<br>what kind of property?</h2>
            <p class="gc-seg-sub">We'll guide you to the right place.</p>
        </div>
        <div id="gcBizHeader" style="display:none;">
            <h2 class="gc-seg-title">Business or Commercial job?<br>No problem.</h2>
            <p class="gc-seg-sub">These are handled by a real person. Enter your details for a quick call back.</p>
        </div>
        
        <div class="gc-seg-type-grid">
            <div class="gc-seg-type-btn active" onclick="setCustomerType('res', this)">
                <span class="gc-seg-label">Residential</span>
            </div>
            <div class="gc-seg-type-btn" onclick="setCustomerType('biz', this)">
                <span class="gc-seg-label">Commercial</span>
            </div>
        </div>

        <div id="gcResForm" class="active">
            <p style="text-align:left; font-size:13px; font-weight:600; color:#2D3748; margin-bottom:8px;">Are we neighbors?</p>
            <input type="tel" id="gcZipInput" class="gc-input-field" placeholder="Enter Zip Code to check availability" maxlength="5" oninput="checkZipInput(this)">
            <div id="gcSegError" class="gc-error-msg">Sorry, we don't cover that area yet. Please check back soon!</div>
            <button id="gcResSubmit" class="gc-btn-lg" onclick="validateSegmentation()" disabled>Let's Go!</button>
        </div>

        <div id="gcBizForm">
            <input type="text" id="gcBizName" class="gc-input-field" placeholder="First & Last Name">
            <input type="text" id="gcBizComp" class="gc-input-field" placeholder="Company (optional)">
            <input type="tel" id="gcBizPhone" class="gc-input-field" placeholder="Phone Number">
            <input type="text" id="gcBizNotes" class="gc-input-field" placeholder="Notes (optional)">
            <input type="tel" id="gcBizZip" class="gc-input-field" placeholder="Zip Code" maxlength="5">
            
            <div id="gcSegSuccess" class="gc-success-msg">Great! We service your area.</div>
            
            <button class="gc-btn-lg" onclick="submitBizLead()">Request Commercial Quote</button>
            
            <div class="gc-contact-box">
                Or Text / Call:
                <a href="tel:3039704383" class="gc-contact-link">303-970-4383</a>
            </div>
        </div>
    </div>
</div>

<div class="gc-progress-track"><div class="gc-progress-fill" id="gcProgress"></div></div>

<div id="gcAppContent" class="gc-content">

    <div id="gc-view-1" class="gc-view active">
        <h2 class="gc-title">Pick Your Window & Glass Care Services</h2>
        <p class="gc-subtitle">Bundle services to unlock discounts.</p>

        <div id="gcSavingsContainer" class="gc-savings-container">
            <div class="gc-savings-track">
                <div id="gcSavingsBar" class="gc-savings-bar"></div>
            </div>
            <div id="gcSavingsText" class="gc-savings-status">Select services to start...</div>
        </div>

        <div class="gc-grid" id="gcServiceGrid"></div>
    </div>

    <div id="gc-view-2" class="gc-view">
        <h2 class="gc-title">Property Details</h2>
        <p class="gc-subtitle">Help us calculate the right price.</p>

        <div class="gc-input-group">
            <div class="gc-label">
                <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/7ca7ee86-bede-4c32-aa79-0cb3713cae8a/pricingui-homesize-icon-dark-200x200.png?format=750w" class="gc-label-icon" alt="Size">
                <div class="gc-label-text">
                    <span>Size of your property</span>
                    <span class="gc-label-sub">Approximate Square footage of your home</span>
                </div>
            </div>
            
            <div class="gc-slider-container">
                <div class="gc-house-grid">
                    <div class="gc-house-card" onclick="selectHouseType(2200, this)">
                        <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/89dda9ff-529a-428a-8b1f-07f296d0a2d1/pricingfactormodal-houssz-small%28200x110%29.png?format=750w" class="gc-house-img" alt="Cozy Home">
                        <span class="gc-house-title">Cozy</span>
                        <span class="gc-house-sub">2-3 Bedrooms</span>
                    </div>
                    <div class="gc-house-card active" onclick="selectHouseType(3000, this)">
                        <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/77ecdd86-9bef-4fd9-ae13-6ef097cdb352/pricingfactormodal-houssz-med.png?format=750w" class="gc-house-img" alt="Comfortable Home">
                        <span class="gc-house-title">Comfortable</span>
                        <span class="gc-house-sub">3-4 Bedrooms</span>
                    </div>
                    <div class="gc-house-card" onclick="selectHouseType(4200, this)">
                        <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/6f103ccc-6a2d-4e69-ba3e-c9bc0555b1e8/pricingfactormodal-houssz-large%28200x110%29.png?format=750w" class="gc-house-img" alt="Spacious Home">
                        <span class="gc-house-title">Spacious</span>
                        <span class="gc-house-sub">5+ Bedrooms</span>
                    </div>
                </div>

                <div style="display: flex; align-items: center; justify-content: center; gap: 5px; margin-bottom: 10px;">
                    <input type="number" id="gcMainSqftInput" value="3000" min="1000" max="8000" step="50" oninput="updateSqftFromInput(this.value)">
                    <span style="font-family: 'Poppins', sans-serif; font-size: 28px; font-weight: 700; color: var(--gc-primary);">sq ft</span>
                </div>
                
                <div style="text-align:center;">
                    <button class="gc-text-btn" onclick="toggleCalculator()">Don't know your square footage?</button>
                </div>
                
                <div id="gcRoomCalc" style="display:none; background:#F7FAFC; padding:15px; border-radius:12px; margin-top:10px; border:1px solid #EDF2F7;">
                    <div style="display:flex; gap:15px; justify-content:center; align-items:flex-end;">
                        <div style="text-align:left;">
                            <label style="font-size:11px; font-weight:700; color:#718096; display:block; margin-bottom:4px;">BEDROOMS</label>
                            <input type="number" class="gc-input-field" style="text-align:center; margin-bottom:0;" oninput="calcFromRooms()" id="gcBeds" placeholder="0">
                        </div>
                        <div style="text-align:left;">
                            <label style="font-size:11px; font-weight:700; color:#718096; display:block; margin-bottom:4px;">BATHROOMS</label>
                            <input type="number" class="gc-input-field" style="text-align:center; margin-bottom:0;" oninput="calcFromRooms()" id="gcBaths" placeholder="0">
                        </div>
                    </div>
                    <div style="font-size:11px; color:#A0AEC0; margin-top:10px; font-style:italic;">Estimated based on Highlands Ranch averages.</div>
                </div>
            </div>
        </div>

        <div class="gc-input-group">
            <div class="gc-label">
                <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/1557277e-5d31-4ac3-b9af-fab32f1fee53/pricingui-homeheight-icon-dark-200x200.png?format=750w" class="gc-label-icon" alt="Stories">
                <div class="gc-label-text">
                    <span>Number of stories</span>
                    <span class="gc-label-sub">Total levels of your home with windows</span>
                </div>
            </div>
            <div class="gc-pill-row">
                <div class="gc-pill-opt" onclick="setStories(1, this)">1 Story<br><span class="gc-pill-sub">0-12'</span></div>
                <div class="gc-pill-opt active" onclick="setStories(2, this)">2 Stories<br><span class="gc-pill-sub">12-24'</span></div>
                <div class="gc-pill-opt" onclick="setStories(3, this)">3+ Stories<br><span class="gc-pill-sub">24'+</span></div>
            </div>
        </div>

        <div class="gc-input-group">
            <div class="gc-toggle-row">
                <div class="gc-toggle-label">
                    <span>Basement</span>
                    <span style="font-size:11px; color:#718096; font-weight:400;">(Windows below ground / egress)</span>
                </div>
                <label class="gc-switch">
                    <input type="checkbox" onchange="state.basement = this.checked">
                    <span class="gc-slider"></span>
                </label>
            </div>
            
            <div class="gc-toggle-row" style="border-top:1px dashed #EDF2F7; margin-top:10px; padding-top:10px;">
                <div class="gc-toggle-label">
                    <span>Skylights</span>
                    <span style="font-size:11px; color:#718096; font-weight:400;">(Roof windows)</span>
                </div>
                <div class="gc-counter-wrapper">
                    <div class="gc-counter-btn" onclick="updateSkylights(-1)">-</div>
                    <div class="gc-counter-val" id="gcSkylightCount">0</div>
                    <div class="gc-counter-btn" onclick="updateSkylights(1)">+</div>
                </div>
            </div>
        </div>

        <div class="gc-input-group">
            <div class="gc-label">
                <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/ecd7fb79-a90a-47ce-b10f-5c66d55853e2/pricingfactormodal-soilinglevel-icon.png?format=750w" class="gc-label-icon" alt="Time">
                <div class="gc-label-text">
                    <span>Time since last service</span>
                    <span class="gc-label-sub">When were your windows last cleaned?</span>
                </div>
            </div>
            <div class="gc-pill-row">
                <div class="gc-pill-opt" onclick="setHistory('low', this)">
                    &lt; 1 Yr<br><span class="gc-pill-sub">Routine</span>
                </div>
                <div class="gc-pill-opt active" onclick="setHistory('mid', this)">
                    1-3 Yrs<br><span class="gc-pill-sub">Standard</span>
                </div>
                <div class="gc-pill-opt" onclick="setHistory('high', this)">
                    &gt; 3 Yrs<br><span class="gc-pill-sub">Deep Clean</span>
                </div>
            </div>
            <div id="gcRestorationMsg" class="gc-warning-box" style="display:none; margin-top:10px; font-size:11px; color:#C53030; background:#FFF5F5; padding:10px; border-radius:8px; border:1px solid #FED7D7;">
                <strong>Note:</strong> Windows uncleaned for 5+ years often require specialized mineral removal.
            </div>
        </div>
    </div>

    <div id="gc-view-3" class="gc-view">
        <h2 class="gc-title">Your Estimate</h2>
        
        <div class="gc-result-card">
            <div style="font-size:12px; font-weight:700; color:#A0AEC0; letter-spacing:1px; text-transform:uppercase; margin-bottom: 5px;">Most Likely</div>
            <div class="gc-price-big" id="gcFinalPrice">~ $000</div>
            
            <div class="gc-range-display">
                <div class="gc-range-item" style="text-align: right;">
                    <span class="gc-range-label">Low Range</span>
                    <span id="gcPriceLow" class="gc-range-val">$000</span>
                </div>
                <div class="gc-range-divider"></div>
                <div class="gc-range-item" style="text-align: left;">
                    <span class="gc-range-label">High Range</span>
                    <span id="gcPriceHigh" class="gc-range-val">$000</span>
                </div>
            </div>
            
            <div class="gc-stats-row" style="margin-bottom: 20px;">
                <div class="gc-stat-item">
                    <span class="gc-stat-label">Home Size</span>
                    <span class="gc-stat-val" id="bd-sqft">--</span>
                </div>
                <div class="gc-stat-item">
                    <span class="gc-stat-label">Est. Panes</span>
                    <span class="gc-stat-val" id="bd-panes">--</span>
                </div>
                <div class="gc-stat-item">
                    <span class="gc-stat-label">Onsite Time</span>
                    <span class="gc-stat-val" id="bd-onsite">--</span>
                </div>
            </div>

            <div id="gcTotalSavings" class="gc-total-savings" style="display:none;">
                <span>⚡ BUNDLE SAVINGS APPLIED:</span>
                <span id="gcSavingsAmount">-$00.00</span>
            </div>

            <table class="gc-breakdown-table">
                <thead>
                    <tr>
                        <th style="width:40%">Service</th>
                        <th style="width:25%">Man Hours</th>
                        <th style="width:35%; text-align:right;">Cost</th>
                    </tr>
                </thead>
                <tbody id="gcBreakdownBody"></tbody>
            </table>

            <div class="gc-trust-section">
                <a href="https://getgleaming.com/gleam-guarantee#5x5spotfree" target="_blank" class="gc-trust-item" style="text-decoration:none;">
                    <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/ca05660b-91ac-434d-80f6-35cc673e8145/5x5+Spot-Free_DS.png?format=1500w" class="gc-trust-icon" alt="5x5 Spot Free">
                    <div>
                        <span class="gc-trust-bold">5x5 Spot Free Guarantee</span>
                        <span>Rain within 5 days? We'll return to touch up as many as 5 windows free of charge.</span>
                    </div>
                </a>
                
                <a href="https://getgleaming.com/gleam-guarantee#100satisfaction" target="_blank" class="gc-trust-item" style="text-decoration:none;">
                    <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/1bf1aafe-e33d-409a-a94b-35c4b0c89929/100%25+sat_DS.png?format=1500w" class="gc-trust-icon" alt="100% Satisfaction">
                    <div>
                        <span class="gc-trust-bold">100% Satisfaction Guarantee</span>
                        <span>We don't leave until you're happy. If you spot an issue, we fix it on the spot.</span>
                    </div>
                </a>

                <div class="gc-trust-item">
                    <img src="https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/adb4da95-64ce-4b68-9cba-f462dab93869/attn_detail.png?format=1500w" class="gc-trust-icon" alt="Detail">
                    <div>
                        <span class="gc-trust-bold">Attention to Detail</span>
                        <span>Our technicians are trained to spot and clean details others miss.</span>
                    </div>
                </div>
            </div>
        </div>

        <p style="text-align:center; font-size:11px; color:#A0AEC0; margin-top:20px; max-width:80%; margin-left:auto; margin-right:auto;">
            *This is a preliminary estimate based on local averages.
        </p>
    </div>
</div>

<div class="gc-footer">
    <button class="gc-btn" id="gcNextBtn" onclick="nav(1)" disabled>Next: Details</button>
    <div class="gc-nav-row">
        <button class="gc-back" id="gcBackBtn" onclick="nav(-1)">
            <span>←</span> Back
        </button>
        <div class="gc-step-badge" id="gcStepText">Step 1/3</div>
    </div>
</div>

<script>
    const CONFIG = {
        validZips: [
            "80109", "80108", "80104", "80131", "80134", "80124", "80130", "80126", "80163", "80116", "80125", "80112", "80118", "80129", "80138", "80122", "80121", "80120", "80111", "80128", "80162", "80015","80160", "80161", "80165", "80166", "80135", "80237", "80016", "80127", "80113", "80123", "80107", "80014", "80425", "80150", "80151", "80155", "80044", "80110", "80133", "80236", "80222", "80231",
            "80013", "80210", "80224", "80208", "80046", "80433", "80247", "80235", "80132", "80012", "80246", "80223", "80017", "80209", "80227", "80219", "80465", "80230", "80018", "80232", "80220", "80206", "80011", "80218", "80921", "80203", "80010", "80042", "80040", "80201", "80217", "80243", "80248", "80250", "80256", "80259", "80261", "80263", "80271", "80273", "80274", "80281", "80291", "80045", "80226", "80264", "80047", "80290", "80204", "80293", "80299", "80117", "80228", "80257", "80265", "80294", "80454", "80207", "80470", "80202", "80205", "80225", "80106", "80041", "80214", "80841","80238", "80211", "80453", "80215", "80216", "80137", "80212", "80239", "80266", "80908", "80866", "80034", "80840", "80457", "80019", "80437", "80419", "80033", "80863", "80401", "80037", "80819", "80002", "80221", "80001", "80006", "80402", "80924", "80920", "80036", "80030", "80024", "80035","80003", "80229", "80004", "80919", "80249", "80102", "80809", "80439", "80831", "80260", "80923","80918", "80640", "80022", "80927", "80005", "80031", "80233", "80814", "80917", "80907", "80475", "80938", "80007", "80922", "80234", "80614", "80904", "80241", "80021", "80939", "80909", "80020",
            "80038", "80601", "80915", "80951", "80950", "80602", "80942", "80931", "80932", "80933", "80934","80935", "80936", "80937", "80941", "80946", "80947", "80949", "80960", "80962", "80970", "80995","80997", "80901", "80829", "80903", "80827", "80448", "80905",
             "97882", "97838", "99346", "97875", "97844", "99338", "99337", "99345", "97826", "97835", "99336", "99363", "99352", "99302", "97818", "99350", "99353", "99323", "99320", "97839", "99354", "99360", "97801", "97813", "98930", "97843", "97810"
        ],
        houseVisuals: {
            small: "https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/89dda9ff-529a-428a-8b1f-07f296d0a2d1/pricingfactormodal-houssz-small%28200x110%29.png?format=750w",
            med: "https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/77ecdd86-9bef-4fd9-ae13-6ef097cdb352/pricingfactormodal-houssz-med.png?format=750w",
            large: "https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/6f103ccc-6a2d-4e69-ba3e-c9bc0555b1e8/pricingfactormodal-houssz-large%28200x110%29.png?format=750w"
        },
        sparkleUrl: "https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/e04d58a2-fe60-48c7-8485-daf7a21ba10f/Sparkle+Favicon.png?format=1500w",
        services: [
            { id: 'ext', name: 'Exterior Window Cleaning', sub: 'Glass, Sills & Frames', icon: 'https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/4cf77caa-aaf4-41ad-bd1a-2d39ba9d1ab4/service-window%26glass-exterior%28300x300%29.png?format=300w' },
            { id: 'int', name: 'Interior Window Cleaning', sub: 'Inside & Detailing', icon: 'https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/647894df-9f0f-4b4c-9f2c-800ec19a043c/service-window%26glass-interior%28300x300%29.png?format=300w' },
            { id: 'scr', name: 'Window Screen Cleaning', sub: 'Scrub and Rinse', icon: 'https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/db20b51d-8504-4373-8879-6b4f5966ea4f/service-window%26glass-screens%28300x300%29.png?format=300w' },
            { id: 'trk', name: 'Window Track Cleaning', sub: 'Scrub and Vacuum', icon: 'https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/9c504379-66e9-4a06-b9fe-58e3a0d61230/service-window%26glass-tracks%28300x300%29.png?format=300w' },
            { id: 'tint', name: 'Window Tint & Film', sub: 'UV Protection & Privacy', icon: 'https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/82ad4b0b-1a7c-42c0-9ce2-f7a3527c7673/service-window%26glass-tint%26film%28300x300%29.png?format=1500w' },
            { id: 'rest', name: 'Window & Glass Restoration', sub: 'Hard Water Removal', icon: 'https://images.squarespace-cdn.com/content/v1/619afe45ad84012af3853c29/84743489-d1dd-4315-b9a7-3a6e2a3284a2/Window_Restoration.png?format=1500w' }
        ]
    };

    let state = {
        step: 1,
        selected: new Set(),
        sqft: 3000,
        stories: 2,
        history: 'mid',
        basement: false,
        skylights: 0,
        customerType: 'res',
        zipCode: '',
        panes: 0,
        basePanes: 0,
        hubLineItems: [],
        zipCodeValidated: false
    };

    function init() {
        const grid = document.getElementById('gcServiceGrid');
        grid.innerHTML = CONFIG.services.map(s => `
            <div class="gc-card" onclick="toggleService('${s.id}', this)">
                <div class="gc-check-circle">✓</div>
                <img src="${s.icon}" class="gc-icon" alt="${s.name}">
                <div class="gc-card-label">${s.name}</div>
                <div class="gc-card-sub">${s.sub}</div>
            </div>
        `).join('');
        updateSavingsUI();
        updateNav();
        updateSqftDisplay(3000);
    }

    function setCustomerType(type, el) {
        state.customerType = type;
        document.querySelectorAll('.gc-seg-type-btn').forEach(btn => btn.classList.remove('active'));
        el.classList.add('active');
        if (type === 'res') {
            document.getElementById('gcResForm').classList.add('active');
            document.getElementById('gcBizForm').classList.remove('active');
            document.getElementById('gcResHeader').style.display = 'block';
            document.getElementById('gcBizHeader').style.display = 'none';
        } else {
            document.getElementById('gcResForm').classList.remove('active');
            document.getElementById('gcBizForm').classList.add('active');
            document.getElementById('gcResHeader').style.display = 'none';
            document.getElementById('gcBizHeader').style.display = 'block';
        }
    }

    function checkZipInput(input) {
        const val = input.value;
        const btn = document.getElementById('gcResSubmit');
        const errorMsg = document.getElementById('gcSegError');
        if(val.length === 5) {
            if(CONFIG.validZips.includes(val)) {
                btn.disabled = false; errorMsg.style.display = 'none'; input.classList.remove('invalid'); input.classList.add('valid');
            } else {
                btn.disabled = true; errorMsg.style.display = 'block'; input.classList.add('invalid');
            }
        } else {
            btn.disabled = true; input.classList.remove('valid', 'invalid'); errorMsg.style.display = 'none';
        }
    }

    function validateSegmentation() {
        const zip = document.getElementById('gcZipInput').value;
        if (CONFIG.validZips.includes(zip)) {
            state.zipCode = zip;
            state.zipCodeValidated = true;
            document.getElementById('gcSegModal').classList.remove('active');
            document.getElementById('gcAppContent').style.filter = 'none';
        }
    }

    function toggleService(id, el) {
        if (!state.zipCodeValidated) {
            document.getElementById('gcSegModal').classList.add('active');
            return;
        }
        state.selected.has(id) ? state.selected.delete(id) : state.selected.add(id);
        el.classList.toggle('selected');
        updateSavingsUI();
        document.getElementById('gcNextBtn').disabled = state.selected.size === 0;
    }

    function updateSavingsUI() {
        const count = state.selected.size;
        const bar = document.getElementById('gcSavingsBar');
        const text = document.getElementById('gcSavingsText');
        const container = document.getElementById('gcSavingsContainer');
        let width = 0, msg = "Select services to start estimate", color = "#718096", containerClass = "";
        const sparkIcon = `<img src="${CONFIG.sparkleUrl}" class="gc-sparkle-img" alt="Sparkle">`;

        if(count === 1) { width = 25; msg = "Select 1 more for <span style='color:var(--gc-primary); text-decoration:underline;'>Basic Savings (5%)</span>"; color = "#2D3748"; }
        else if(count === 2) { width = 50; msg = `${sparkIcon} BASIC UNLOCKED (5% OFF)`; color = "#3D9898"; containerClass = "unlocked-basic"; }
        else if(count === 3) { width = 75; msg = `${sparkIcon} PREMIUM UNLOCKED (7.5% OFF)`; color = "#D69E2E"; containerClass = "unlocked-premium"; }
        else if(count >= 4) { width = 100; msg = `${sparkIcon} PREMIUM PLUS: 10% OFF (MAX SAVINGS)`; color = "#3D9898"; containerClass = "unlocked-plus"; }

        bar.style.width = width + "%"; text.innerHTML = msg; text.style.color = color;
        container.className = 'gc-savings-container ' + containerClass;
    }

    function setSqft(val) { state.sqft = val; updateSqftDisplay(val); }
    function selectHouseType(val, el) {
        document.querySelectorAll('.gc-house-card').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        setSqft(val);
    }
    function updateSqftFromInput(val) {
        const numVal = parseInt(val);
        if(!isNaN(numVal) && numVal >= 500 && numVal <= 10000) { state.sqft = numVal; }
    }
    function updateSqftDisplay(val) {
        state.sqft = parseInt(val);
        const input = document.getElementById('gcMainSqftInput');
        if (document.activeElement !== input) { input.value = parseInt(val); }
    }
    function toggleCalculator() {
        const calc = document.getElementById('gcRoomCalc');
        calc.style.display = calc.style.display === 'none' ? 'block' : 'none';
    }
    function calcFromRooms() {
        const beds = parseInt(document.getElementById('gcBeds').value) || 0;
        const baths = parseInt(document.getElementById('gcBaths').value) || 0;
        if (beds > 0 || baths > 0) {
            const calcTotal = (beds * 850) + (baths * 300);
            updateSqftDisplay(calcTotal);
            document.getElementById('gcMainSqftInput').style.borderColor = '#3D9898';
        }
    }
    function setStories(val, el) {
        state.stories = val;
        el.parentElement.querySelectorAll('.gc-pill-opt').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
    }
    function setHistory(val, el) {
        state.history = val;
        el.parentElement.querySelectorAll('.gc-pill-opt').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        const msg = document.getElementById('gcRestorationMsg');
        msg.style.display = val === 'high' ? 'block' : 'none';
    }
    function updateSkylights(change) {
        let newVal = state.skylights + change;
        if (newVal < 0) newVal = 0;
        state.skylights = newVal;
        document.getElementById('gcSkylightCount').innerText = newVal;
    }

    function calculateWindowEstimate(sqFt, stories, hasBasement, packageType, soilingLevel, skylightCount, isFrenchPanes, includeScreens, includeTracks, includeSealing) {
        const PRICING = {
            baseRate: 1.95, logisticsFee: 60.00,
            soiling: { low: 0.02, mid: 1.18, high: 1.81 },
            height2ndStory: 0.88, height3rdStory: 1.79,
            largePaneSurcharge: 1.85, frenchPaneRate: 4.42,
            skylightPrice: 15.00, basementSurcharge: 2.50,
            screenPrice: 2.50, trackPrice: 3.50, sealingPrice: 1.50,
            largePaneRatio: 0.10, largePaneRatioUpper: 0.05
        };
        const DENSITY = { low: 0.010, mid: 0.014, high: 0.016 };
        function distributePanes(totalPanes) {
            let p1 = 0, p2 = 0, p3 = 0;
            if (stories === 1) { p1 = totalPanes; }
            else if (stories === 2) { p1 = Math.ceil(totalPanes * 0.65); p2 = totalPanes - p1; }
            else if (stories === 3) { p1 = Math.ceil(totalPanes * 0.60); p2 = Math.ceil(totalPanes * 0.30); p3 = totalPanes - p1 - p2; }
            return { p1, p2, p3 };
        }
        function getPrice(densityKey, returnBreakdown = false) {
            let basePanes = Math.ceil(sqFt * DENSITY[densityKey]);
            let basementPanes = hasBasement ? 8 : 0;
            let counts = distributePanes(basePanes);
            let total = PRICING.logisticsFee;
            let effectiveBase = isFrenchPanes ? PRICING.frenchPaneRate : PRICING.baseRate;
            let soilFee = PRICING.soiling[soilingLevel] || PRICING.soiling.mid;
            let price1st = effectiveBase + soilFee;
            let price2nd = effectiveBase + soilFee + PRICING.height2ndStory;
            let price3rd = effectiveBase + soilFee + PRICING.height3rdStory;
            let priceBsmt = effectiveBase + soilFee + PRICING.basementSurcharge;
            let extTotal = (counts.p1 * price1st) + (counts.p2 * price2nd) + (counts.p3 * price3rd) + (basementPanes * priceBsmt);
            if (!isFrenchPanes) {
                let largeCount = Math.ceil(counts.p1 * PRICING.largePaneRatio);
                let largeCountUpper = Math.ceil((counts.p2 + counts.p3) * PRICING.largePaneRatioUpper); 
                extTotal += (largeCount + largeCountUpper) * PRICING.largePaneSurcharge;
            }
            total += extTotal;
            let intTotal = 0;
            if (packageType === 'deluxe') {
                let totalPanes = counts.p1 + counts.p2 + counts.p3 + basementPanes;
                intTotal = totalPanes * effectiveBase;
                if (!isFrenchPanes) {
                    let largeCountInt = Math.ceil(counts.p1 * PRICING.largePaneRatio);
                    intTotal += largeCountInt * PRICING.largePaneSurcharge;
                }
                total += intTotal;
            }
            let skyTotal = 0;
            if (skylightCount > 0) { skyTotal = skylightCount * PRICING.skylightPrice; total += skyTotal; }
            let totalPanes = counts.p1 + counts.p2 + counts.p3 + basementPanes;
            let screenTotal = 0, trackTotal = 0;
            if (includeScreens) { screenTotal = totalPanes * PRICING.screenPrice; total += screenTotal; }
            if (includeTracks) { trackTotal = totalPanes * PRICING.trackPrice; total += trackTotal; }
            if (includeSealing) total += totalPanes * PRICING.sealingPrice;
            if (returnBreakdown) {
                return { total: Math.ceil(total), ext: extTotal, int: intTotal, sky: skyTotal, scr: screenTotal, trk: trackTotal, logistics: PRICING.logisticsFee };
            }
            return Math.ceil(total);
        }
        let midResult = getPrice('mid', true);
        let svcCount = (packageType === 'deluxe' ? 2 : 1) + (includeScreens ? 1 : 0) + (includeTracks ? 1 : 0);
        let discount = svcCount >= 4 ? 0.10 : (svcCount === 3 ? 0.075 : (svcCount === 2 ? 0.05 : 0));
        return {
            basePanes: Math.ceil(sqFt * DENSITY.mid),
            basementPanes: hasBasement ? 8 : 0,
            estimatedPanes: Math.ceil(sqFt * DENSITY.mid) + (hasBasement ? 8 : 0),
            priceLow: Math.ceil(getPrice('low') * (1 - discount)),
            priceMid: Math.ceil(midResult.total * (1 - discount)),
            priceHigh: Math.ceil(getPrice('high') * (1 - discount)),
            rawTotal: midResult.total,
            discount: discount,
            breakdown: midResult
        };
    }

    function calculate() {
        const pkg = state.selected.has('int') ? 'deluxe' : 'exterior';
        const result = calculateWindowEstimate(
            state.sqft, state.stories, state.basement, pkg, state.history, state.skylights,
            false, state.selected.has('scr'), state.selected.has('trk'), false
        );
        state.panes = result.estimatedPanes;
        state.basePanes = result.basePanes;
        let breakdownHTML = '';
        const TIMES = { screen: 1.17, track: 3.60, logistics: 40, skylight: 7.5 }; 
        let totalMinutes = TIMES.logistics; 
        const paneCount = result.estimatedPanes;
        const fmtTime = (mins) => {
            if(mins < 60) return `${Math.round(mins)}m`;
            let h = Math.floor(mins/60), m = Math.round(mins%60);
            return `${h}h ${m}m`;
        };
        const fmtCost = (raw, discPercent) => {
            const final = raw * (1 - discPercent), saved = raw - final;
            let html = `<div class="gc-price-stack">`;
            if (saved > 1) {
                html += `<span class="gc-price-old">$${Math.round(raw)}</span>`;
                html += `<div><span class="gc-price-new">$${Math.round(final)}</span> <span class="gc-savings-pill">Save $${Math.round(saved)}</span></div>`;
            } else { html += `<span class="gc-price-new">$${Math.round(final)}</span>`; }
            html += `</div>`;
            return html;
        };
        const items = [];
        let extTime = paneCount * 2.57;
        items.push({ name: 'Exterior Cleaning', cost: result.breakdown.ext, time: extTime });
        if (state.selected.has('int')) {
            let intTime = paneCount * 1.57;
            items.push({ name: 'Interior Cleaning', cost: result.breakdown.int, time: intTime });
        }
        if (state.selected.has('scr')) {
            let sTime = paneCount * TIMES.screen;
            items.push({ name: 'Screens', cost: result.breakdown.scr, time: sTime });
        }
        if (state.selected.has('trk')) {
            let tTime = paneCount * TIMES.track;
            items.push({ name: 'Deep Track Clean', cost: result.breakdown.trk, time: tTime });
        }
        if (state.skylights > 0) {
            let skyTime = state.skylights * TIMES.skylight;
            items.push({ name: `Skylights (x${state.skylights})`, cost: result.breakdown.sky, time: skyTime });
        }
        items.push({ name: 'Logistics & Setup', cost: result.breakdown.logistics, time: TIMES.logistics });

        // Build data handoff array
        state.hubLineItems = items.map(item => ({
            name: item.name,
            sub: item.name === 'Exterior Cleaning' ? 'Glass, Frames & Sills' : 
                 item.name === 'Interior Cleaning' ? 'Inside Glass & Sills' : '',
            price: item.cost,
            time: item.time > 60 ? `${Math.floor(item.time/60)}h ${Math.round(item.time%60)}m` : `${Math.round(item.time)}m`
        }));

        totalMinutes = items.reduce((sum, i) => sum + i.time, 0);

        breakdownHTML = items.map(item => {
            const displayTime = item.time > 60 ? `${Math.floor(item.time/60)}h ${Math.round(item.time%60)}m` : `${Math.round(item.time)}m`;
            const displaySub = item.name === 'Exterior Cleaning' ? 'Glass, Frames & Sills' : 
                               item.name === 'Interior Cleaning' ? 'Inside Glass & Sills' : '';
            return `
                <tr>
                    <td><strong>${item.name}</strong><br><span style="font-size:11px; color:#718096;">${displaySub}</span></td>
                    <td class="gc-td-time">${displayTime}</td>
                    <td>${item.name === 'Logistics & Setup' ? `$${Math.round(item.cost)}` : fmtCost(item.cost, result.discount)}</td>
                </tr>
            `;
        }).join('');

        let onsiteMinutes = totalMinutes / 1.47;

        document.getElementById('gcFinalPrice').innerText = `~ $${result.priceMid}`;
        document.getElementById('gcPriceLow').innerText = `$${result.priceLow}`;
        document.getElementById('gcPriceHigh').innerText = `$${result.priceHigh}`;
        document.getElementById('bd-sqft').innerText = `${state.sqft.toLocaleString()} sq ft`;
        document.getElementById('bd-panes').innerText = `~${result.estimatedPanes}`;
        document.getElementById('bd-onsite').innerText = fmtTime(onsiteMinutes);
        if (result.rawTotal > result.priceMid) {
            document.getElementById('gcTotalSavings').style.display = 'flex';
            document.getElementById('gcSavingsAmount').innerText = `-$${result.rawTotal - result.priceMid}`;
        } else {
            document.getElementById('gcTotalSavings').style.display = 'none';
        }
        document.getElementById('gcBreakdownBody').innerHTML = breakdownHTML;
    }

    function nav(dir) {
        state.step += dir;
        updateNav();
        if(state.step === 3) calculate();
    }

    function updateNav() {
        for(let i=1; i<=3; i++) {
            document.getElementById(`gc-view-${i}`).classList.toggle('active', i === state.step);
        }
        const prog = (state.step / 3) * 100;
        document.getElementById('gcProgress').style.width = `${prog}%`;
        document.getElementById('gcStepText').innerText = `Step ${state.step}/3`;
        const backBtn = document.getElementById('gcBackBtn');
        const nextBtn = document.getElementById('gcNextBtn');
        backBtn.style.visibility = state.step > 1 ? 'visible' : 'hidden';
        
        if(state.step === 1) {
            nextBtn.innerText = "Next: Details";
            nextBtn.disabled = state.selected.size === 0;
            nextBtn.onclick = () => nav(1);
        } else if (state.step === 2) {
            nextBtn.innerText = "See Estimate";
            nextBtn.onclick = () => nav(1);
        } else {
            nextBtn.innerText = "Book This Job"; 
            nextBtn.onclick = () => {
                const selectedServices = Array.from(state.selected).join(',');
                const finalPriceRaw = document.getElementById('gcFinalPrice').innerText.replace(/[^0-9.]/g, '');
                const savingsElement = document.getElementById('gcSavingsAmount');
                const savingsRaw = savingsElement ? savingsElement.innerText.replace(/[^0-9.]/g, '') : '0';
                const onsiteTimeRaw = document.getElementById('bd-onsite').innerText;

                // Serialize the line items array we built in calculate()
                const encodedBreakdown = encodeURIComponent(JSON.stringify(state.hubLineItems));

                const redirectUrl = `https://getgleaming.com/online-booking?panes=${state.panes}&stories=${state.stories}&services=${selectedServices}&sqft=${state.sqft}&onsite=${encodeURIComponent(onsiteTimeRaw)}&base=${finalPriceRaw}&savings=${savingsRaw}&breakdown=${encodedBreakdown}`;

                window.location.href = redirectUrl;
            };
        }
    }
    init();
</script>

</div>
</body>
</html>